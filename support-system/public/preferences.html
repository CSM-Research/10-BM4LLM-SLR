<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Step 2 - Choose Prompt and Model</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link rel="stylesheet" href="assets/style.css" />
  <style>
    .navbar-toggler-icon {
      background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'%3e%3cpath stroke='rgba%28255, 255, 255, 1%29' stroke-linecap='round' stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/%3e%3c/svg%3e");
    }
  </style>
</head>

<body class="bg-light">
  <!-- Sidebar Offcanvas -->
  <div class="offcanvas offcanvas-start text-bg-dark" tabindex="-1" id="sidebar" aria-labelledby="sidebarLabel">
    <div class="offcanvas-header">
      <h5 class="offcanvas-title" id="sidebarLabel"><a style="text-decoration: none; color: white;"
          href="login-management.html"> BM4LLM-SLR </a></h5>
      <button type="button" class="btn-close btn-close-white" data-bs-dismiss="offcanvas" aria-label="Close"></button>
    </div>
    <div class="offcanvas-body">
      <ul class="nav flex-column">
        <li class="nav-item text-white-50 fw-bold mt-2">Welcome</li>
        <li class="nav-item"><a class="nav-link text-white" href="index.html">Introduction</a></li>
        <li class="nav-item"><a class="nav-link text-white" href="instructions.html">Instructions</a></li>
        <li class="nav-item text-white-50 fw-bold mt-4">Configuration</li>
        <li class="nav-item"><a class="nav-link text-white active" href="questionnaire.html">Participant Profile</a>
        </li>
        <li class="nav-item"><a class="nav-link text-white active" href="preferences.html">Run Setup</a></li>
        <li class="nav-item text-white-50 fw-bold mt-4">Pre-Selection Phase</li>
        <li class="nav-item"><a class="nav-link text-white" href="experimentation.html">LLM-Assisted Review</a></li>
        <li class="nav-item text-white-50 fw-bold mt-4">Looping Phase</li>
        <li class="nav-item"><a class="nav-link text-white" href="hil-confidence.html">Start Looping</a></li>
        <li class="nav-item text-white-50 fw-bold mt-4">Results</li>
        <li class="nav-item"><a class="nav-link text-white" href="#">Final Report</a></li>
      </ul>
    </div>
  </div>

  <!-- Top Navbar -->
  <nav class="navbar bg-dark text-white">
    <div class="container-fluid">
      <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#sidebar"
        aria-controls="sidebar">
        <span class="navbar-toggler-icon"></span>
      </button>
      <span class="navbar-brand mb-0 h1 text-white"><a style="text-decoration: none; color: white;"
          href="login-management.html"> BM4LLM-SLR </a></span>
    </div>
  </nav>

  <!-- Main Content -->
  <div class="container py-5">
    <div class="row justify-content-center">
      <div class="col-lg-10 bg-white p-4 rounded shadow-sm">
        <h2 class="mb-4 text-center">Preferences</h2>

        <div id="runsBox" class="mb-4 p-3 border rounded bg-light">
          <h5 class="mb-2">Your Previous Runs:</h5>
          <ul id="runList" class="list-group"></ul>
        </div>

        <h4 class="mb-3">Choose the theme of your systematic review:</h4>
        <div class="mb-4">
          <select class="form-select" id="theme" required>
            <option value="">-- Select a theme --</option>
            <option value="1">Machine learning in software defect prediction: A business-driven systematic mapping study
            </option>
            <option value="2">A systematic mapping study and practitioner insights on the use of software engineering
              practices to develop MVPs</option>
            <option value="3">Digital-twin-based testing for cyber–physical systems: A systematic literature review
            </option>
            <option value="4">Conflict management techniques for model merging: a systematic mapping review</option>
            <option value="5">A systematic literature review on source code similarity measurement and clone detection:
              Techniques, applications, and challenges</option>
            <option value="6">How far are we from reproducible research on code smell detection? A systematic literature
              review</option>
            <option value="7">Predictive maintenance using digital twins: A systematic literature review</option>
            <option value="8">Model-driven engineering for mobile robotic systems: a systematic mapping study</option>
            <option value="9">Systematic literature review of domain-oriented specification techniques</option>
            <option value="10">A decade of code comment quality assessment: A systematic literature review</option>
            <option value="11">Multi-paradigm modeling for cyber–physical systems: A systematic mapping review</option>
            <option value="12">Software product line applied to the internet of things: A systematic literature review
            </option>
            <option value="13">Time pressure in software engineering: A systematic review</option>
            <option value="14">Modeling and automatic code generation for wireless sensor network applications using
              model-driven or business process approaches: A systematic mapping study</option>
          </select>
        </div>

        <p class="mb-4">Choose your preferred prompt style and language model for study screening.</p>

        <form id="selectionForm">
          <div class="accordion mb-4" id="promptAccordion">

            <!-- Prompt 1 -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingFelizardo">
                <button class="accordion-button" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseFelizardo" aria-expanded="true" aria-controls="collapseFelizardo">
                  <input class="form-check-input me-2" type="radio" name="prompt" value="felizardo" required />
                  Felizardo (2024)
                </button>
              </h2>
              <div id="collapseFelizardo" class="accordion-collapse collapse show" aria-labelledby="headingFelizardo"
                data-bs-parent="#promptAccordion">
                <div class="accordion-body">
                  <pre class="bg-light p-3 rounded">
Assume you are a software engineering researcher conducting a systematic literature review (SLR).
Consider the title, abstract, and keywords of a primary study.

Title: <the title of the primary study>
Abstract: <the abstract of the primary study>
Keywords: <the keywords of the primary study>

Using a 1-7 Likert scale (1 - Strongly disagree, ..., 7 - Strongly agree), rate your agreement with:
< IC1 - Description of inclusion criteria 1. >
< IC2 - Description of inclusion criteria 2. >

do not give me a file, instead answer in chat in csv format
                  </pre>
                </div>
              </div>
            </div>

            <!-- Prompt 2 -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingHuotala">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseHuotala" aria-expanded="false" aria-controls="collapseHuotala">
                  <input class="form-check-input me-2" type="radio" name="prompt" value="huotala" />
                  Huotala (2024)
                </button>
              </h2>
              <div id="collapseHuotala" class="accordion-collapse collapse" aria-labelledby="headingHuotala"
                data-bs-parent="#promptAccordion">
                <div class="accordion-body">
                  <pre class="bg-light p-3 rounded">
Role: You are a software engineering researcher conducting a systematic literature review (SLR).

Task: Evaluate a primary study using three types of assessments, applied to:

a) The overall relevance of the primary study  
b) Each individual inclusion/exclusion criterion

Assessment Types:
1) Binary classification: "true" or "false"
2) Probability classification: Float between 0.000 and 1.000
3) Likert scale: Integer from 1 to 7

Primary study:
Title: """{0}"""
Abstract: """{1}"""
                  </pre>
                </div>
              </div>
            </div>

            <!-- Prompt 3 -->
            <div class="accordion-item">
              <h2 class="accordion-header" id="headingThode">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                  data-bs-target="#collapseThode" aria-expanded="false" aria-controls="collapseThode">
                  <input class="form-check-input me-2" type="radio" name="prompt" value="thode" />
                  Thode (2024)
                </button>
              </h2>
              <div id="collapseThode" class="accordion-collapse collapse" aria-labelledby="headingThode"
                data-bs-parent="#promptAccordion">
                <div class="accordion-body">
                  <pre class="bg-light p-3 rounded">
Assume you are an expert professor in Software Engineering conducting an SLR.

Evaluate studies based on:
Inclusion Criteria (IC): Criteria from primary candidate study  
Exclusion Criteria (EC): Criteria from primary candidate study

Scoring:
- Score 1 for strong alignment with all ICs
- Score 0 if any IC is not satisfied or any EC is met

Response Format:
Score: X  
Justification: Explanation...
                  </pre>
                </div>
              </div>
            </div>

          </div>

          <hr class="my-4">

          <h4 class="mb-3">Choose your top 3 preferred language models:</h4>
          <div class="row g-3 mb-3">
            <div class="col-md-4">
              <label for="model1" class="form-label">1st Preference</label>
              <select class="form-select" id="model1" required>
                <option value="">-- Select --</option>
                <option>ChatGPT</option>
                <option>Gemini</option>
                <option>Deepsek</option>
                <option>Claude 3</option>
                <option>Llama 3</option>
                <option>Mistral</option>
                <option>Cohere</option>
                <option>Perplexity</option>
                <option>Other</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="model2" class="form-label">2nd Preference</label>
              <select class="form-select" id="model2" required>
                <option value="">-- Select --</option>
                <option>ChatGPT</option>
                <option>Gemini</option>
                <option>Deepsek</option>
                <option>Claude 3</option>
                <option>Llama 3</option>
                <option>Mistral</option>
                <option>Cohere</option>
                <option>Perplexity</option>
                <option>Other</option>
              </select>
            </div>
            <div class="col-md-4">
              <label for="model3" class="form-label">3rd Preference</label>
              <select class="form-select" id="model3" required>
                <option value="">-- Select --</option>
                <option>ChatGPT</option>
                <option>Gemini</option>
                <option>Deepsek</option>
                <option>Claude 3</option>
                <option>Llama 3</option>
                <option>Mistral</option>
                <option>Cohere</option>
                <option>Perplexity</option>
                <option>Other</option>
              </select>
            </div>
          </div>

          <div class="text-end">
            <button type="submit" class="btn btn-success">Continue</button>
          </div>
        </form>

      </div>
    </div>
  </div>

  <!-- Bootstrap & Script -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    document.getElementById('selectionForm').addEventListener('submit', async function (event) {
      event.preventDefault();

      const email = localStorage.getItem('participantEmail');
      const theme = document.getElementById('theme').value;
      const prompt = document.querySelector('input[name="prompt"]:checked')?.value;

      const model1 = document.getElementById('model1').value;
      const model2 = document.getElementById('model2').value;
      const model3 = document.getElementById('model3').value;

      if (!email || !theme || !prompt || !model1 || !model2 || !model3) {
        alert("Please complete all selections.");
        return;
      }

      const runData = {
        email,
        theme,
        prompt,
        firstmodel: model1,
        secondmodel: model2,
        thirdmodel: model3
      };

      try {
        const res = await fetch('/start-run', {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(runData)
        });

        if (!res.ok) throw new Error('Failed to create run.');
        const { runId } = await res.json();

        localStorage.setItem('runId', runId);
        localStorage.setItem('currentRun', JSON.stringify(runData));
        localStorage.setItem('model1', model1);
        localStorage.setItem('model2', model2);
        localStorage.setItem('model3', model3);

        window.location.href = `experimentation.html`;
      } catch (err) {
        console.error(err);
        alert("Error starting the run.");
      }
    });

    async function loadRuns() {
      const email = localStorage.getItem('participantEmail');
      const currentRunId = localStorage.getItem('runId');
      if (!email) return;

      try {
        const res = await fetch(`/runs/${email}`);
        if (!res.ok) throw new Error("Failed to fetch runs");
        const runs = await res.json();

        const runList = document.getElementById('runList');
        if (!runList) return;

        runList.innerHTML = runs.length === 0
          ? '<li class="list-group-item">No previous runs found.</li>'
          : '';

        runs.forEach(run => {
          const li = document.createElement('li');
          li.className = 'list-group-item d-flex justify-content-between align-items-center';
          li.innerHTML = `Theme: ${run.theme}, Prompt: ${run.prompt}, Models: ${run.firstmodel}, ${run.secondmodel}, ${run.thirdmodel} 
          ${run.id == currentRunId ? '<span class="badge bg-success rounded-pill">Current</span>' : ''}`;
          runList.appendChild(li);
        });
      } catch (err) {
        console.error("Erro ao carregar runs:", err);
      }
    }

    loadRuns();
  </script>

</body>

</html>